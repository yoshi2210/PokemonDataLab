# ポケモンで学ぶデータモデリングとAPI

ポケモンに関するデータは、大きく分けて3種類の取得方法があるといえる。Bulbapedia, SEREBI NET,Veekunあたりが有名どころだ。  
１つ目は、まとめWikiサイトや公式サイトからスクレイピングする方法。  
２つ目は、１つ目の方法で取得されたデータを成形したcsv等のフラットファイルをダウンロードする方法。Kaggle dataset が好例だ。  
３つ目が、１つ目の方法で取得されたデータを、APIを通じて取得する方法で、PokeAPIがある。  

２つ目の方法は簡単なために多くの個人開発で用いられているが、必ずしもユーザーが使いたい情報が含まれていない場合がある。また、ポケモンの世代更新に併せて更新されることが少なく、持続的な開発とならないリスクもある。よって、保守運用管理の面で信頼のおけるAPIを活用することで、自由かつ継続的なデータ活用が期待できる。

ポケモンに関するAPIの例として、PokeAPIがあげられる。有志によりメンテナンスされているAPIで、すでにSV世代の情報も有している。そこで今回はこのPokeAPIを活用する方法を取りまとめる。


# PokeAPI

# データモデリング

PokeAPIでデータが取得できることはわかった。しかしAPIの利用法とは別に、どのような形でデータを取得および保持することが好ましいのかは、別途データの用途に応じて考える必要がある。これは、データモデリングと呼ばれる作業に相当する。TLTRということで、今回は下図を考えた。

## DL, DWH, DM

多くのネットの記事ではデータ活用の目的はあらかた決まっており、必要な形でAPIをたたけばよかった。しかし、今後様々な用途でデータが活用できるように準備しておく為には、それを念頭にデータの持ち方を変える必要がある。最近のトレンドとしては、DataLake、DataWareHouse、DataMartの３種類のデータの持ち方をしておくと便利と言われているように思う。料理でたとえると、スーパーで買ったじゃがいもをそのままいれておくのがDataLake、皮をむいておくのがDataWareHouse、角切りなり串切りなり銀杏切りなり切り方で別々のタッパーにいれてあるのがDataWareHouseといったところだろうか。DataMartはデータ活用の目的に応じて必要最小限を定義すればよいので、ここではDataWareHouseのデータモデルを検討することにする。

# コンセプチュアル/ロジカル/フィジカル データモデル

データモデルを考える上で３つのモデルがあると言われている。どのような概念をどういう関係性でとらえるかナラティブに記述したコンセプチュアルデータモデル。もう一歩具体的にデータの対応関係も含めて記述したロジカルデータモデル。最終的にデータ型まで指定してソフトウェアの設計書として必要な情報が記されたフィジカルデータモデル。これらを記述するときには、Entity-Relation図　と呼ばれるフォーマットが有用だ。Draw-io等、いい感じにかいてくれるツールも多いが、実際は謎テンプレートExcelで各社好きに作っていることの方が多い印象だ。  

# 良いモデルと悪いモデル

DataWareHouseとして、良いモデルと悪いモデルとの違いは何か。平たく言えば、適切に正規化されていると良いモデルと言われたりする。  

そもそも良いモデルの条件とは何か。  

先ず、無駄な重複がないことがあげられる。列にも行にも、無駄なメモリを使わないことは省エネと言えるだろう。  

次に、保守性が高い＝データの追加変更が簡便である方がよい。例えば、ポケモンのタイプは最大２種類と思われているが、今後３種もつポケモンが生まれたとき、なるべく手間をかけたくない。

また、DataMart側での処理が簡便であることもあげられる。これはDataWareHouseの目的が柔軟で簡便なDataMartの作成にあるので当然といえるが、バランス感覚が必要だ。毎度カレーをつくるならカレー用のジャガイモを事前に切っておけばよいが、突然面が広くて薄いポテトチップスを作りたいといわれたときにでも対応できるかはよく考える必要がある。

他にも基準はいろいろあるし、なんならDataWareHouseをさらに目的に応じてDataVaultとInfomationVaultに分けようかみたいな話も有ったりするので、データモデリングが気になる方は最強のポケモンデータモデルを作ってほしい。

話を戻すと、大体上の基準をルールっぽくまとめたのが第１～第３正規化だ。

# 正規化
この時、タイプ１、タイプ２という列でデータを持っていたら、タイプ３というカラムを追加して過去のポケモンのデータにはNaNを入れる必要があり、これがまた面倒くさい。他のテーブルとくっつけるときにカラム名で指定している場合はタイプ３が漏れることになり最悪だ。一方で、タイプ、というカラムだけがあり、１ポケモン１タイプを１行としていた場合はただ行を１行追加するだけで終わって簡単だ。
s
# Poke-ER図

以上から、ポケモンに関するDataWareHouseを作るためにロジカルデータモデルを描くとこんなもんではないだろうか。  

それぞれのテーブルをAPIをたたいて出力し保存するコードは下記に格納した。


# 最後に

今回はポケモンの生態を取り扱っているAPIをもちいてデータモデリングを行った。しかし、ポケモン勝負の観点でデータモデリングを行うとまったく異なるモデルとなるので、今後の分析の目的に応じて今回作ったDataWareHouseも改善する必要があるだろう。






