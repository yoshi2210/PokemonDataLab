# ポケモンで学ぶ数理最適化

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/drive/1Ru4grZ8U-fFmM8oIXotT5O0qo7xHA-Z8#scrollTo=Q7nNjv2_EPCj)


ポケモンでは最大6匹の構成をパーティーとよび、いろいろなトレーナと戦うことができる。  
ストーリー上のラスボスは四天王＆チャンピオンと呼ばれており、特に強力なパーティーでプレイヤーを待ち構えているので、しっかりと準備したパーティーで臨まないと敗北は必至だ。  

ポケモンにはタイプと6種類の種族値という能力値が固定で割り振られている。タイプには相性があり、種族値は高い方が勝負に有利といえる。 
他にも、ポケモンが覚えることができる4種の技、持ち物や特性、努力値、個体値などなど、勝負を分かつ要素は多々あり、プレイヤーはこれらを組み合わせてパーティーを考えることになる。

もちろん、数字だけがポケモンではない。最初に選ぶことができるポケモンはパートナーとして艱難辛苦をともに乗り越える中で、パーティーに欠かせない存在となっているだろう。しかし残念ながら現実は非情である。    
<img src="https://user-images.githubusercontent.com/26848253/214755507-79491d8d-f720-4331-9b4e-bcf2e293374e.png" width="20%">

例えばバクフーンは、炎タイプ、種族値はHP 78(224位),攻撃84(261位),防御78(212位),特攻109(106位),特防85(165位),素早さ100(102位),合計534(120位)  バクフーンはどうがんばっても、才能的に上位互換が119匹いるのだ。  

では、想いと現実にどう折り合いをつけて、どんなパーティーを組めば効率的に四天王＆チャンピオンを倒すことができるのか。”数理最適化”で計算機に解いてもらうことにした。


# 数理最適化とは
数理最適化とは簡単に言えば、複数の条件を満たしながら特定の値を最大最小化させる組み合わせを推測する手法である。  
教師あり学習、教師なし学習、強化学習といった”AI”とよく呼ばれるものとは性質が少しことなる。  
ある意味で教師なし学習とも括られうるが、最適化では人間側が作ったルールに則って膨大な組み合わせを如何に効率的に探索するかが争点となる。  
効率的に探索するアルゴリズムは”ソルバー”とも呼ばれ、MatlabやPythonをはじめ、いろいろなツールが開発されている。  

今回は中でも、pythonで用いられる pulp　を使ってみることとした。

# 問題設定
<img src="https://user-images.githubusercontent.com/26848253/214758901-3113bd06-f2c7-46e6-9bb2-3007a3d42cab.png" width="30%">
ダイアモンドパールの四天王＆チャンピオンを効果的に倒しつつ、想い入れのあるポケモンを含んだパーティーを組むことを考える。  
問題の単純化のため、タイプと種族値をベースに考えることにする。目的変数と制約条件を下のように設定する。

<br>
<br>

目的変数
- ポケモンの種族値合計を最大化するパーティーを組む

制約条件
- パーティー数は6匹
- 想い入れのあるポケモン群の中から最低1匹含める
- 相手が出しうる全てのタイプにたいして、優位的タイプを持つポケモンが最低2匹いる

# 結果
![image](https://user-images.githubusercontent.com/26848253/214760205-1603cabc-7987-4372-a736-0235f069b301.png)

容赦なさすぎるパーティーになってしまった。  

![image](https://user-images.githubusercontent.com/26848253/214760333-81e73f66-044a-4812-bd45-f32d78ac2186.png)

流石に伝説系はアレなので除外して再度、求解させるとそれっぽい結果となった。


# さいごに
pulpは初めてでしたが、pythonのpandasやnumpyに慣れていても変数や積和計算の設定に結構面食らって理解に時間を使ってしまった。  
計算量が少ない問題設定だったのですぐに求解できたが、技や持ち物も制約条件に加えるとややこしそうで面白そう。  
より良いコードや、より詳細な最適化に取り組んだりされたら是非勉強させてください。  

だれですかこの人は、、、と思ったらSVポケモンでした。
![image](https://user-images.githubusercontent.com/26848253/214760469-e1747cc7-b846-4d8c-9a08-b64057735fa7.png)




# 参考
https://towardsdatascience.com/determining-the-optimal-pokemon-team-for-pokemon-brilliant-diamond-and-shining-pearl-with-pulp-d589ae9b2e68
https://www.youtube.com/watch?v=4z3T3UJxcgc
https://gamepedia.jp/pokemon-sv/monsters/4323
